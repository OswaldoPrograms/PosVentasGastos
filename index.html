<!DOCTYPE html>
<html lang="es">

<head>
    <!-- META INFORMACIÃ“N BÃSICA -->
    <meta charset="UTF-8">
    <!-- Permite caracteres especiales en espaÃ±ol (acentos, Ã±, etc.) -->
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Configura la escala para dispositivos mÃ³viles: ancho = ancho del dispositivo, zoom inicial = 100% -->
    
    <title>El Triciclo del Sabor - POS</title>
    <!-- TÃ­tulo que aparece en la pestaÃ±a del navegador -->
    
    <!-- ESTILOS CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Importa el archivo de estilos CSS de la aplicaciÃ³n -->
    
    <!-- PWA MANIFEST -->
    <link rel="manifest" href="manifest.json">
    <!-- Configura la aplicaciÃ³n como PWA (Progressive Web App) para poder instalarla en mÃ³viles -->
    
    <!-- TEMA DEL NAVEGADOR -->
    <!-- Color del tema que aparece en la barra de navegaciÃ³n del navegador (especialmente en mÃ³viles) -->
    <meta name="theme-color" content="#6C5CE7">
    <!-- Usa sistema de fonts nativo para mejor rendimiento offline y apariencia nativa -->
    
    <!-- LIBRERÃAS EXTERNAS PARA REPORTES -->
    <!-- jsPDF: librerÃ­a para generar reportes en PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- jsPDF AutoTable: extensiÃ³n para crear tablas automÃ¡ticas en PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- XLSX: librerÃ­a para generar reportes en Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- REGISTRO DEL SERVICE WORKER Y LIMPIEZA DE CACHE ANTIGUO -->
    <script>
        // Registra el Service Worker y ejecuta limpieza/migraciÃ³n de caches antiguos
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    await navigator.serviceWorker.register('./service-worker.js');
                    console.log('Service Worker registrado');
                } catch (err) {
                    console.log('Error al registrar SW', err);
                }

                // Desregistrar service workers antiguos que mencionen 'gemini' en su URL
                if (navigator.serviceWorker.getRegistrations) {
                    try {
                        const regs = await navigator.serviceWorker.getRegistrations();
                        for (const r of regs) {
                            const url = (r && r.active && r.active.scriptURL) ? r.active.scriptURL.toLowerCase() : '';
                            if (url.includes('gemini')) {
                                await r.unregister();
                                console.log('Desregistrado antiguo Service Worker:', url);
                            }
                        }
                    } catch (e) {
                        console.log('Error al listar/desregistrar SWs', e);
                    }
                }

                // Borrar caches cuyos nombres contengan referencias antiguas (gemini...)
                if (window.caches && caches.keys) {
                    try {
                        const keys = await caches.keys();
                        for (const key of keys) {
                            const k = key.toLowerCase();
                            if (k.includes('gemini') || k.includes('gemini_pos') || k.includes('gemini-pos') || k.includes('gemini pos')) {
                                await caches.delete(key);
                                console.log('Cache antiguo borrado:', key);
                            }
                        }
                    } catch (e) {
                        console.log('Error al listar/borrar caches', e);
                    }
                }

                // MigraciÃ³n simple de LocalStorage: si existe gemini_pos_data pero no triciclo_pos_data, copiarlo
                try {
                    if (!localStorage.getItem('triciclo_pos_data') && localStorage.getItem('gemini_pos_data')) {
                        localStorage.setItem('triciclo_pos_data', localStorage.getItem('gemini_pos_data'));
                        console.log('Datos migrados: gemini_pos_data -> triciclo_pos_data');
                    }
                } catch (e) {
                    console.log('Error en migraciÃ³n de LocalStorage', e);
                }

                // Sugerencia: para ver cambios inmediatamente, haga una recarga dura (Ctrl+F5) o abra DevTools -> Application -> Service Workers -> Unregister
            });
        }
    </script>
</head>

<body>
    <!-- CONTENEDOR PRINCIPAL DE LA APLICACIÃ“N -->
    <div id="app">
        <!-- NAVEGACIÃ“N LATERAL (Escritorio) / BARRA INFERIOR (MÃ³vil) -->
        <!-- El CSS se encarga de cambiar el layout segÃºn el tamaÃ±o de la pantalla -->
        <nav id="main-nav">
            <!-- MARCA/LOGO DE LA APLICACIÃ“N -->
            <div class="nav-brand">
                <h1>El Triciclo del Sabor</h1>
            </div>
            
            <!-- ENLACES DE NAVEGACIÃ“N -->
            <ul class="nav-links">
                <!-- INVENTARIO: Vista principal para gestionar productos -->
                <li data-view="inventory" class="active">
                    <span class="icon">ğŸ“¦</span>
                    <span class="label">Inventario</span>
                </li>
                
                <!-- PUNTO DE VENTA: Sistema para vender productos durante el dÃ­a -->
                <li data-view="pos">
                    <span class="icon">ğŸ›’</span>
                    <span class="label">Punto de Venta</span>
                </li>
                
                <!-- VENTAS: Historial de ventas realizadas con filtros y reportes -->
                <li data-view="sales">
                    <span class="icon">ğŸ“Š</span>
                    <span class="label">Ventas</span>
                </li>
                
                <!-- AGREGAR GASTO: Formulario para registrar nuevos gastos -->
                <li data-view="add-expense">
                    <span class="icon">â•</span>
                    <span class="label">Agregar Gasto</span>
                </li>
                
                <!-- VER GASTOS: Registro de todos los gastos con filtros -->
                <li data-view="view-expenses">
                    <span class="icon">ğŸ’¸</span>
                    <span class="label">Ver Gastos</span>
                </li>
                
                <!-- DATOS: Exportar/importar datos y respaldos -->
                <li data-view="settings">
                    <span class="icon">ğŸ“</span>
                    <span class="label">Datos</span>
                </li>
            </ul>
        </nav>

        <!-- ÃREA DE CONTENIDO PRINCIPAL -->
        <!-- AquÃ­ se inyecta dinÃ¡micamente el contenido de cada vista -->
        <main id="main-content">
            <!-- El contenido se carga mediante JavaScript en app.js -->
        </main>
    </div>

    <!-- SCRIPTS PRINCIPALES -->
    <!-- Carga el archivo JavaScript que contiene toda la lÃ³gica de la aplicaciÃ³n -->
    <script src="app.js"></script>
</body>

</html>